From: Hilko Bengen <bengen@debian.org>
Date: Tue, 10 Mar 2020 20:06:39 +0100
Subject: Make sure that generated ocaml-link.sh is used in out-of-tree builds

---
 common/mlpcre/Makefile.am     |  4 ++--
 common/mlstdutils/Makefile.am |  4 ++--
 common/mltools/Makefile.am    | 24 ++++++++++++------------
 common/mlutils/Makefile.am    |  4 ++--
 common/mlvisit/Makefile.am    |  4 ++--
 5 files changed, 20 insertions(+), 20 deletions(-)

diff --git a/common/mlpcre/Makefile.am b/common/mlpcre/Makefile.am
index a1d8b02..3636a46 100644
--- a/common/mlpcre/Makefile.am
+++ b/common/mlpcre/Makefile.am
@@ -106,9 +106,9 @@ OCAMLLINKFLAGS = $(LINK_CUSTOM_OCAMLC_ONLY)
 pcre_tests_DEPENDENCIES = \
 	$(pcre_tests_THEOBJECTS) \
 	$(MLPCRE_CMA) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 pcre_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh \
+	$(top_builddir)/ocaml-link.sh \
 	  -cclib '-pthread -lpthread -lutils -lpcre2-8 -lgnu' -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) $(OCAMLLINKFLAGS) \
 	  $(OCAMLPACKAGES) $(OCAMLPACKAGES_TESTS) \
diff --git a/common/mlstdutils/Makefile.am b/common/mlstdutils/Makefile.am
index 5b6667f..b5490a8 100644
--- a/common/mlstdutils/Makefile.am
+++ b/common/mlstdutils/Makefile.am
@@ -129,9 +129,9 @@ OCAMLLINKFLAGS = $(LINK_CUSTOM_OCAMLC_ONLY)
 std_utils_tests_DEPENDENCIES = \
 	$(std_utils_tests_THEOBJECTS) \
 	$(MLSTDUTILS_CMA) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 std_utils_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh -- \
+	$(top_builddir)/ocaml-link.sh -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) $(OCAMLLINKFLAGS) \
 	  $(OCAMLPACKAGES) $(OCAMLPACKAGES_TESTS) \
 	  $(std_utils_tests_THEOBJECTS) -o $@
diff --git a/common/mltools/Makefile.am b/common/mltools/Makefile.am
index 26e4668..343fd92 100644
--- a/common/mltools/Makefile.am
+++ b/common/mltools/Makefile.am
@@ -261,7 +261,7 @@ tools_utils_tests_DEPENDENCIES = \
 	../mlgettext/mlgettext.$(MLARCHIVE) \
 	../mlpcre/mlpcre.$(MLARCHIVE) \
 	$(MLTOOLS_CMA) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 tools_utils_tests_OCAMLCLIBS = \
 	-pthread -lpthread \
 	-lutils \
@@ -269,7 +269,7 @@ tools_utils_tests_OCAMLCLIBS = \
 	-lgnu \
 	$(LIBGUESTFS_LIBS)
 tools_utils_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh \
+	$(top_builddir)/ocaml-link.sh \
 	  -cclib '$(tools_utils_tests_OCAMLCLIBS)' -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) $(OCAMLLINKFLAGS) \
 	  $(OCAMLPACKAGES) $(OCAMLPACKAGES_TESTS) \
@@ -281,7 +281,7 @@ getopt_tests_DEPENDENCIES = \
 	../mlgettext/mlgettext.$(MLARCHIVE) \
 	../mlpcre/mlpcre.$(MLARCHIVE) \
 	$(MLTOOLS_CMA) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 getopt_tests_OCAMLCLIBS = \
 	-pthread -lpthread \
 	-lutils \
@@ -289,7 +289,7 @@ getopt_tests_OCAMLCLIBS = \
 	-lgnu \
 	$(LIBGUESTFS_LIBS)
 getopt_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh \
+	$(top_builddir)/ocaml-link.sh \
 	  -cclib '$(getopt_tests_OCAMLCLIBS)' -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) $(OCAMLLINKFLAGS) \
 	  $(OCAMLPACKAGES) $(OCAMLPACKAGES_TESTS) \
@@ -301,9 +301,9 @@ JSON_tests_DEPENDENCIES = \
 	../mlgettext/mlgettext.$(MLARCHIVE) \
 	../mlpcre/mlpcre.$(MLARCHIVE) \
 	$(MLTOOLS_CMA) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 JSON_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh \
+	$(top_builddir)/ocaml-link.sh \
 	  -cclib '-pthread -lpthread $(LIBGUESTFS_LIBS)' -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) $(OCAMLLINKFLAGS) \
 	  $(OCAMLPACKAGES) $(OCAMLPACKAGES_TESTS) \
@@ -315,9 +315,9 @@ JSON_parser_tests_DEPENDENCIES = \
 	../mlgettext/mlgettext.$(MLARCHIVE) \
 	../mlpcre/mlpcre.$(MLARCHIVE) \
 	$(MLTOOLS_CMA) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 JSON_parser_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh \
+	$(top_builddir)/ocaml-link.sh \
 	  -cclib '-pthread -lpthread $(OCAMLCLIBS) $(LIBGUESTFS_LIBS)' -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) $(OCAMLLINKFLAGS) \
 	  $(OCAMLPACKAGES) $(OCAMLPACKAGES_TESTS) \
@@ -329,9 +329,9 @@ machine_readable_tests_DEPENDENCIES = \
 	../mlgettext/mlgettext.$(MLARCHIVE) \
 	../mlpcre/mlpcre.$(MLARCHIVE) \
 	$(MLTOOLS_CMA) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 machine_readable_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh \
+	$(top_builddir)/ocaml-link.sh \
 	  -cclib '-pthread -lpthread -lutils -lgnu $(LIBGUESTFS_LIBS)' -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) $(OCAMLLINKFLAGS) \
 	  $(OCAMLPACKAGES) $(OCAMLPACKAGES_TESTS) \
@@ -343,9 +343,9 @@ tools_messages_tests_DEPENDENCIES = \
 	../mlgettext/mlgettext.$(MLARCHIVE) \
 	../mlpcre/mlpcre.$(MLARCHIVE) \
 	$(MLTOOLS_CMA) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 tools_messages_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh \
+	$(top_builddir)/ocaml-link.sh \
 	  -cclib '-pthread -lpthread -lutils -lgnu $(LIBGUESTFS_LIBS)' -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) $(OCAMLLINKFLAGS) \
 	  $(OCAMLPACKAGES) $(OCAMLPACKAGES_TESTS) \
diff --git a/common/mlutils/Makefile.am b/common/mlutils/Makefile.am
index 17dfac3..2f58123 100644
--- a/common/mlutils/Makefile.am
+++ b/common/mlutils/Makefile.am
@@ -127,9 +127,9 @@ c_utils_unit_tests_DEPENDENCIES = \
 	$(c_utils_unit_tests_THEOBJECTS) \
 	../mlstdutils/mlstdutils.$(MLARCHIVE) \
 	mlcutils.$(MLARCHIVE) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 c_utils_unit_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh -cclib '-lutils -lgnu' -- \
+	$(top_builddir)/ocaml-link.sh -cclib '-lutils -lgnu' -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) \
 	  $(OCAMLPACKAGES) -package ounit2 \
 	  $(OCAMLLINKFLAGS) \
diff --git a/common/mlvisit/Makefile.am b/common/mlvisit/Makefile.am
index beff0bc..a20cbc9 100644
--- a/common/mlvisit/Makefile.am
+++ b/common/mlvisit/Makefile.am
@@ -114,7 +114,7 @@ visit_tests_DEPENDENCIES = \
 	$(visit_tests_THEOBJECTS) \
 	../mlutils/mlcutils.$(MLARCHIVE) \
 	$(MLVISIT_CMA) \
-	$(top_srcdir)/ocaml-link.sh
+	$(top_builddir)/ocaml-link.sh
 visit_tests_OCAMLCLIBS = \
 	-pthread -lpthread \
 	-lvisit \
@@ -123,7 +123,7 @@ visit_tests_OCAMLCLIBS = \
 	$(LIBXML2_LIBS) \
 	$(LIBGUESTFS_LIBS)
 visit_tests_LINK = \
-	$(top_srcdir)/ocaml-link.sh \
+	$(top_builddir)/ocaml-link.sh \
 	  -cclib '$(visit_tests_OCAMLCLIBS)' -- \
 	  $(OCAMLFIND) $(BEST) $(OCAMLFLAGS) $(OCAMLLINKFLAGS) \
 	  $(OCAMLPACKAGES) $(OCAMLPACKAGES_TESTS) \
